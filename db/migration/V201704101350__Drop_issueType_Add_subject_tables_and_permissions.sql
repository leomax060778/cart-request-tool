/*--------------- SUBJECT MIGRATION ---------------*/

/* 
-- *************************************************************************************
Delete referential constraints to allow the table drop.

select * from "REFERENTIAL_CONSTRAINTS"
where TABLE_NAME = 'CRT_ISSUE_TYPE'
order by COLUMN_NAME

ALTER TABLE "CART_REQUEST_TOOL"."CRT_ISSUE_TYPE" DROP CONSTRAINT _SYS_CONSTRAINT_179189_#22_#F0;

*/

-- *************************************************************************************
/* Change table name from "ISSUE_TYPE" to "SUBJECT", and from "CRT_ISSUE_TYPE" to "CRT_SUBJECT" */
DROP TABLE "CART_REQUEST_TOOL"."ISSUE_TYPE";
RENAME TABLE "CART_REQUEST_TOOL"."CRT_ISSUE_TYPE" TO "CRT_SUBJECT";

-- *************************************************************************************
	-- SUBJECT
create column table subject
(
	subject_id integer not null primary key generated by default as IDENTITY,
	name nvarchar(255) not null,
	additional_subject_information tinyint default 0,

	created_date_tz timestamp default CURRENT_TIMESTAMP,
	modified_date_tz timestamp,
	created_user_id bigint not null,
	modified_user_id bigint,
	enabled tinyint default 1, 
	deleted tinyint default 0
);

INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (1,'Status Check',0,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (2,'SRM system issue',0,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (3,'GPO Process issue',0,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (4,'Delayed GPO approval',0,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (5,'Other',1,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (6,'YVC System Issue',0,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (7,'Incorrect Information',0,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (8,'Missing Information',0,1);
INSERT INTO "CART_REQUEST_TOOL"."SUBJECT" (SUBJECT_ID, NAME, ADDITIONAL_SUBJECT_INFORMATION, CREATED_USER_ID) VALUES (9,'Respondig to Request/Inquiry',0,1);

-- *************************************************************************************
	-- CRT_SUBJECT
RENAME COLUMN "CART_REQUEST_TOOL"."CRT_SUBJECT".ISSUE_TYPE_ID to SUBJECT_ID;
DELETE FROM "CART_REQUEST_TOOL"."CRT_SUBJECT";
ALTER TABLE "CART_REQUEST_TOOL"."CRT_SUBJECT" ADD FOREIGN KEY ( "SUBJECT_ID" ) REFERENCES "CART_REQUEST_TOOL"."SUBJECT" ("SUBJECT_ID") ON UPDATE RESTRICT ON DELETE RESTRICT;

INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (2,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (2,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (2,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (2,4,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (2,5,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,6,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,7,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,8,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,4,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,6,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,7,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,8,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,4,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,6,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,7,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,8,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,4,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,6,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,7,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,8,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,4,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (5,9,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (3,9,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (4,9,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (6,9,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_SUBJECT" (CRT_TYPE_ID, SUBJECT_ID, CREATED_USER_ID) VALUES (2,9,1);

-- *************************************************************************************
-- New Permissions
INSERT INTO "CART_REQUEST_TOOL"."PERMISSION_SERVICE"(PERMISSION_SERVICE_ID, SERVICE_NAME, PERMISSION_ID, RESOURCE_ID,CREATED_USER_ID) values(195,'subjectService',9,13,1);
INSERT INTO "CART_REQUEST_TOOL"."PERMISSION_SERVICE"(PERMISSION_SERVICE_ID, SERVICE_NAME, PERMISSION_ID, RESOURCE_ID,CREATED_USER_ID) values(196,'subjectService',10,6,1);
INSERT INTO "CART_REQUEST_TOOL"."PERMISSION_SERVICE"(PERMISSION_SERVICE_ID, SERVICE_NAME, PERMISSION_ID, RESOURCE_ID,CREATED_USER_ID) values(197,'subjectService',11,6,1);

-- *************************************************************************************
-- Update schema version
INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT) 
VALUES('V2.0.0-35', 'Drop ISSUE_TYPE table, Add SUBJECT table, with its corresponding data and permissions', 'V201704101350__Drop_issueType_Add_subject_tables_and_permissions.sql');

COMMIT;