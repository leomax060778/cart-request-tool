/*--------------- MESSAGE_TYPE MIGRATION ---------------*/

/* 
-- *************************************************************************************
Delete referential constraints to allow the table drop.

select * from "REFERENTIAL_CONSTRAINTS"
where TABLE_NAME = 'CRT_RETURN_TYPE'
order by COLUMN_NAME

ALTER TABLE "CART_REQUEST_TOOL"."CRT_RETURN_TYPE" DROP CONSTRAINT <CONSTRAINT>;

*/

-- *************************************************************************************
/* Change table from "RETURN_TYPE" to "MESSAGE_TYPE", and from "CRT_RETURN_TYPE" to "CRT_MESSAGE_TYPE" */
DROP TABLE "CART_REQUEST_TOOL"."RETURN_TYPE";
RENAME TABLE "CART_REQUEST_TOOL"."CRT_RETURN_TYPE" TO "CRT_MESSAGE_TYPE";

-- *************************************************************************************
-- MESSAGE_TYPE
create column table message_type
(
	message_type_id integer not null primary key generated by default as IDENTITY,
	name nvarchar(255) not null,
	additional_message_type_information tinyint default 0,

	created_date_tz timestamp default CURRENT_TIMESTAMP,
	modified_date_tz timestamp,
	created_user_id bigint not null,
	modified_user_id bigint,
	enabled tinyint default 1, 
	deleted tinyint default 0
);

INSERT INTO "CART_REQUEST_TOOL"."MESSAGE_TYPE" (MESSAGE_TYPE_ID, NAME, CREATED_USER_ID, ADDITIONAL_MESSAGE_TYPE_INFORMATION) VALUES (1,'FYI Only',1,0);
INSERT INTO "CART_REQUEST_TOOL"."MESSAGE_TYPE" (MESSAGE_TYPE_ID, NAME, CREATED_USER_ID, ADDITIONAL_MESSAGE_TYPE_INFORMATION) VALUES (2,'BM Eyes Only',1,0);
INSERT INTO "CART_REQUEST_TOOL"."MESSAGE_TYPE" (MESSAGE_TYPE_ID, NAME, CREATED_USER_ID, ADDITIONAL_MESSAGE_TYPE_INFORMATION) VALUES (3,'Request Response',1,0);

-- *************************************************************************************
	-- CRT_MESSAGE_TYPE
RENAME COLUMN "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE".RETURN_TYPE_ID to MESSAGE_TYPE_ID;
DELETE FROM "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE"
ALTER TABLE "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" ADD FOREIGN KEY ( "MESSAGE_TYPE_ID" ) REFERENCES "CART_REQUEST_TOOL"."MESSAGE_TYPE" ("MESSAGE_TYPE_ID") ON UPDATE RESTRICT ON DELETE RESTRICT;
ALTER TABLE "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" ADD (STATUS_ID BIGINT DEFAULT 0);

INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (1,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (1,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (1,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (2,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (2,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (2,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (3,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (3,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (3,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (4,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (4,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (4,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (5,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (5,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (5,3,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (6,1,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (6,2,1);
INSERT INTO "CART_REQUEST_TOOL"."CRT_MESSAGE_TYPE" (CRT_TYPE_ID, MESSAGE_TYPE_ID, CREATED_USER_ID) VALUES (6,3,1);

-- *************************************************************************************
-- New Permissions
INSERT INTO "CART_REQUEST_TOOL"."PERMISSION_SERVICE"(PERMISSION_SERVICE_ID, SERVICE_NAME, PERMISSION_ID, RESOURCE_ID,CREATED_USER_ID) values(192,'messageTypeService',9,13,1);
INSERT INTO "CART_REQUEST_TOOL"."PERMISSION_SERVICE"(PERMISSION_SERVICE_ID, SERVICE_NAME, PERMISSION_ID, RESOURCE_ID,CREATED_USER_ID) values(193,'messageTypeService',10,6,1);
INSERT INTO "CART_REQUEST_TOOL"."PERMISSION_SERVICE"(PERMISSION_SERVICE_ID, SERVICE_NAME, PERMISSION_ID, RESOURCE_ID,CREATED_USER_ID) values(194,'messageTypeService',11,6,1);

-- *************************************************************************************
-- Update schema version
INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT) 
VALUES('V2.0.0-34', 'Drop RETURN_TYPE table, Add MESSAGE_TYPE table, with its corresponding data and permissions', 'V201704101345__Drop_returnType_Add_messageType_tables_and_permissions.sql');

COMMIT;