-- *************************************************************************************
-- New Vendor Request
-- Create column for date submitted
ALTER TABLE "CART_REQUEST_TOOL"."VENDOR_REQUEST" ADD (RECEIVER_DATE_SUBMITTED_TZ TIMESTAMP);
-- Populate new column
UPDATE "CART_REQUEST_TOOL"."VENDOR_REQUEST"
SET RECEIVER_DATE_SUBMITTED_TZ = TO_TIMESTAMP(TO_NVARCHAR(CREATED_DATE_TZ, 'MM-DD-YYYY'), 'MM-DD-YYYY');

-- Create table for changed fields
CREATE COLUMN TABLE "CART_REQUEST_TOOL"."VENDOR_REQUEST_CHANGED_COLUMN" (
			VENDOR_REQUEST_CHANGED_COLUMN_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
			VENDOR_REQUEST_ID BIGINT NOT NULL,
			COLUMN_NAME NVARCHAR(255) NOT NULL,
			DISPLAY_NAME NVARCHAR(255),

			CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
		 	MODIFIED_DATE_TZ TIMESTAMP,
		 	CREATED_USER_ID BIGINT NOT NULL,
		 	MODIFIED_USER_ID BIGINT,
		 	ENABLED TINYINT DEFAULT 1,
		 	DELETED TINYINT DEFAULT 0
);

ALTER TABLE "CART_REQUEST_TOOL"."VENDOR_REQUEST_CHANGED_COLUMN" ADD FOREIGN KEY ( "VENDOR_REQUEST_ID" ) REFERENCES "CART_REQUEST_TOOL"."VENDOR_REQUEST" ("VENDOR_REQUEST_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "CART_REQUEST_TOOL"."VENDOR_REQUEST_CHANGED_COLUMN" ADD FOREIGN KEY ( "CREATED_USER_ID" ) REFERENCES "CART_REQUEST_TOOL"."USER" ("USER_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;

-- *************************************************************************************
-- Vendor Inquiry
-- Create table for changed fields
CREATE COLUMN TABLE "CART_REQUEST_TOOL"."VENDOR_INQUIRY_CHANGED_COLUMN" (
			VENDOR_INQUIRY_CHANGED_COLUMN_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
			VENDOR_INQUIRY_ID BIGINT NOT NULL,
			COLUMN_NAME NVARCHAR(255) NOT NULL,
			DISPLAY_NAME NVARCHAR(255),

			CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
		 	MODIFIED_DATE_TZ TIMESTAMP,
		 	CREATED_USER_ID BIGINT NOT NULL,
		 	MODIFIED_USER_ID BIGINT,
		 	ENABLED TINYINT DEFAULT 1,
		 	DELETED TINYINT DEFAULT 0
);

ALTER TABLE "CART_REQUEST_TOOL"."VENDOR_INQUIRY_CHANGED_COLUMN" ADD FOREIGN KEY ( "VENDOR_INQUIRY_ID" ) REFERENCES "CART_REQUEST_TOOL"."VENDOR_INQUIRY" ("VENDOR_INQUIRY_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "CART_REQUEST_TOOL"."VENDOR_INQUIRY_CHANGED_COLUMN" ADD FOREIGN KEY ( "CREATED_USER_ID" ) REFERENCES "CART_REQUEST_TOOL"."USER" ("USER_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;

-- *************************************************************************************
-- Change Vendor Request
-- Create column for date submitted
ALTER TABLE "CART_REQUEST_TOOL"."CHANGE_VENDOR_REQUEST" ADD (RECEIVER_DATE_SUBMITTED_TZ TIMESTAMP);
-- Populate new column
UPDATE "CART_REQUEST_TOOL"."CHANGE_VENDOR_REQUEST"
SET RECEIVER_DATE_SUBMITTED_TZ = TO_TIMESTAMP(TO_NVARCHAR(CREATED_DATE_TZ, 'MM-DD-YYYY'), 'MM-DD-YYYY');

-- Create table for changed fields
CREATE COLUMN TABLE "CART_REQUEST_TOOL"."CHANGE_VENDOR_REQUEST_CHANGED_COLUMN" (
			CHANGE_VENDOR_REQUEST_CHANGED_COLUMN_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
			CHANGE_VENDOR_REQUEST_ID BIGINT NOT NULL,
			COLUMN_NAME NVARCHAR(255) NOT NULL,
			DISPLAY_NAME NVARCHAR(255),

			CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
		 	MODIFIED_DATE_TZ TIMESTAMP,
		 	CREATED_USER_ID BIGINT NOT NULL,
		 	MODIFIED_USER_ID BIGINT,
		 	ENABLED TINYINT DEFAULT 1,
		 	DELETED TINYINT DEFAULT 0
);

ALTER TABLE "CART_REQUEST_TOOL"."CHANGE_VENDOR_REQUEST_CHANGED_COLUMN" ADD FOREIGN KEY ( "CHANGE_VENDOR_REQUEST_ID" ) REFERENCES "CART_REQUEST_TOOL"."CHANGE_VENDOR_REQUEST" ("CHANGE_VENDOR_REQUEST_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "CART_REQUEST_TOOL"."CHANGE_VENDOR_REQUEST_CHANGED_COLUMN" ADD FOREIGN KEY ( "CREATED_USER_ID" ) REFERENCES "CART_REQUEST_TOOL"."USER" ("USER_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;

-- *************************************************************************************
-- Extend Vendor Request
-- Create column for date submitted
ALTER TABLE "CART_REQUEST_TOOL"."EXTEND_VENDOR_REQUEST" ADD (RECEIVER_DATE_SUBMITTED_TZ TIMESTAMP);
-- Populate new column
UPDATE "CART_REQUEST_TOOL"."EXTEND_VENDOR_REQUEST"
SET RECEIVER_DATE_SUBMITTED_TZ = TO_TIMESTAMP(TO_NVARCHAR(CREATED_DATE_TZ, 'MM-DD-YYYY'), 'MM-DD-YYYY');

-- Create table for changed fields
CREATE COLUMN TABLE "CART_REQUEST_TOOL"."EXTEND_VENDOR_REQUEST_CHANGED_COLUMN" (
			EXTEND_VENDOR_REQUEST_CHANGED_COLUMN_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
			EXTEND_VENDOR_REQUEST_ID BIGINT NOT NULL,
			COLUMN_NAME NVARCHAR(255) NOT NULL,
			DISPLAY_NAME NVARCHAR(255),

			CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
		 	MODIFIED_DATE_TZ TIMESTAMP,
		 	CREATED_USER_ID BIGINT NOT NULL,
		 	MODIFIED_USER_ID BIGINT,
		 	ENABLED TINYINT DEFAULT 1,
		 	DELETED TINYINT DEFAULT 0
);

ALTER TABLE "CART_REQUEST_TOOL"."EXTEND_VENDOR_REQUEST_CHANGED_COLUMN" ADD FOREIGN KEY ( "EXTEND_VENDOR_REQUEST_ID" ) REFERENCES "CART_REQUEST_TOOL"."EXTEND_VENDOR_REQUEST" ("EXTEND_VENDOR_REQUEST_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;
ALTER TABLE "CART_REQUEST_TOOL"."EXTEND_VENDOR_REQUEST_CHANGED_COLUMN" ADD FOREIGN KEY ( "CREATED_USER_ID" ) REFERENCES "CART_REQUEST_TOOL"."USER" ("USER_ID") ON UPDATE RESTRICT ON DELETE RESTRICT
;

-- *************************************************************************************
-- Update crt version
INSERT INTO APPLICATION_VERSION(VERSION, APPLICATION_ID, CREATED_USER_ID, RELEASE_NOTES)
VALUES('2.0.19',1,1,'Added red indicators for Vendor Request / Inquiries in Processing Report. Made editable Date fields in Processing Report.');

-- *************************************************************************************
-- Update schema version

INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT)
VALUES('V2.0.0-92', 'Supported red indicators and date field edition for Vendor Request / Inquiries in Processing Report', 'V201811021010__Create_changed_column_tables_vendor_request_inquiry.sql');

COMMIT;