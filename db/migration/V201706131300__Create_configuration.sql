-- *************************************************************************************
-- Drop previous table

DROP TABLE "CART_REQUEST_TOOL"."CONFIGURATION";

-- *************************************************************************************
-- Create new table

CREATE COLUMN TABLE CONFIGURATION
(
	CONFIGURATION_ID BIGINT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
   	CONF_KEY NVARCHAR(255),
	CONF_VALUE NVARCHAR(500),
    CONF_DESCRIPTION NVARCHAR(500),
	
	CREATED_DATE_TZ TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	MODIFIED_DATE_TZ TIMESTAMP,
	CREATED_USER_ID BIGINT NOT NULL,
	MODIFIED_USER_ID BIGINT,
	ENABLED TINYINT DEFAULT 1, 
	DELETED TINYINT DEFAULT 0
);

-- *************************************************************************************
-- Add foreign key

ALTER TABLE "CART_REQUEST_TOOL"."CONFIGURATION" ADD FOREIGN KEY ( "CREATED_USER_ID" ) REFERENCES "CART_REQUEST_TOOL"."USER" ("USER_ID") ON UPDATE RESTRICT ON DELETE RESTRICT;

-- *************************************************************************************
-- Insert values

INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('AppUrl','http://localhost:63342/crt/webapp/index.html#','APPLICATION''S URL',1);
INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('UrlLogin','http://localhost:63342/crt/webapp/index.html','LOGIN''S URL',1);
INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('SMTPAccount','[{address: "lpeccin@folderit.net"}]','ACCOUNT TO SMTP SERVER',1);
INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('SupportAccount','lpeccin@folderit.net','ACCOUNT TO SUPPORT EMAIL',1);
INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('SiteAdministrator','lpeccin@folderit.net','ACCOUNT TO ADMIN EMIAL',1);
INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('emailAccounts','[{address: "iberon@folderit.net"}, {address: "lhildt@folderit.net"}]','ACCOUNTS TO SEND EMAILS',1);
INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('tokenLifeTimeSeconds','43200','LIFE TIME TO TOKEN''S USER.',1);
INSERT INTO CONFIGURATION(CONF_KEY,CONF_VALUE,CONF_DESCRIPTION,CREATED_USER_ID) VALUES('defaultPassword','123456','DEFAULT PASSWORD',1);

-- *************************************************************************************
-- Update schema version

INSERT INTO SCHEMA_VERSION(VERSION, DESCRIPTION, SCRIPT) 
VALUES('V2.0.0-50', 'Created new configuration table', 'V201706131300__Create_configuration.sql');

COMMIT;